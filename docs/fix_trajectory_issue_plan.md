## 问题分析结果
经过对代码的深入分析，我找到了您反馈的两个问题的根本原因：

### 问题1：场景描述转移到工作流时内容不完整
原因分析：

- 问题出现在前端的 `App.tsx` 文件中的 `extractScenarioFromConversation` 函数
- 该函数使用了多种策略来提取场景描述，但策略的优先级和匹配条件可能导致提取不完整：
  1. 首先查找包含特定关键词的综合摘要
  2. 然后查找最长的综合响应
  3. 接着组合多个相关消息
  4. 最后使用最后一个实质性AI消息作为回退
具体问题：

- 关键词匹配过于严格，可能错过重要的场景描述
- 消息长度阈值（150字符、200字符）可能过滤掉有用信息
- 多消息组合时只取最后3条，可能遗漏早期重要描述
### 问题2：3D可视化中出现与描述不一致的绕圈车辆
原因分析：

- 问题出现在前端的 `DataAdapter.ts` 文件中
- `generateVehicleTrajectory` 函数硬编码了三种轨迹模式：
  1. straight - 直线行驶（车辆0）
  2. circular - 圆形路径 （车辆1）
  3. figure8 - 8字形路径 （车辆2）
具体问题：

- 后端的 `_mock_generate_scenario_files` 生成的是基础的OpenSCENARIO文件，没有具体的车辆行为定义
- 前端DataAdapter在解析时，如果没有找到具体的车辆行为，就会创建默认的演示车辆，并 自动分配不同的轨迹模式
- 这导致即使用户描述的是"高速超车"场景，系统也会生成包含圆形和8字形轨迹的车辆
### 问题定位：数据文件问题 + 可视化问题
这是一个 复合问题 ：

1. 数据文件问题 ：后端生成的mock数据过于简单，缺乏具体的车辆行为和轨迹定义
2. 可视化问题 ：前端DataAdapter使用硬编码的演示轨迹，没有根据实际场景描述生成相应的车辆行为
### 建议解决方案
1. 改进场景描述提取 ：
   
   - 优化 extractScenarioFromConversation 函数的匹配策略
   - 降低字符长度阈值，增加更多关键词匹配
   - 改进多消息组合逻辑
2. 改进车辆轨迹生成 ：
   
   - 修改 generateVehicleTrajectory 函数，根据场景描述生成相应轨迹
   - 对于"超车"场景，生成直线轨迹和变道轨迹
   - 避免在非循环场景中使用圆形或8字形轨迹
3. 增强后端数据生成 ：
   
   - 改进 _mock_generate_scenario_files 函数，根据AI提取的参数生成更具体的车辆行为
   - 添加基于场景类型的轨迹模板